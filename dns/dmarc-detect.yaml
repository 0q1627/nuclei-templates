id: dmarc-detect

info:
  name: DMARC Detection
  author: brenocss
  severity: info
  tags: dns,dmarc
  reference: https://support.google.com/a/answer/2466580?hl=en

dns:
  - name: _dmarc.{{FQDN}}
    type: TXT
    class: inet
    recursion: true
    retries: 3

    matchers:
      - type: dsl
        dsl:
          - "contains(tolower(answer), 'v=dmarc1')"
          - "rcode == 0"
        condition: and

    extractors:
      - type: regex
        group: 1
        regex:
          - "mailto:([a-z-@.]+);"
          - "mailto:([a-z-@.]+),"